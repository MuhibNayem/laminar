# Example Laminar Configuration for Spring Boot
# Place this in src/main/resources/application.yml

laminar:
  # Maximum number of pending requests per entity worker before rejecting (backpressure)
  # Default: 1000
  max-waiters: 10000
  
  # Maximum batch size (number of waiters) per entity
  # Prevents memory exhaustion from unbounded coalescing
  # Default: 10000
  max-batch-size: 50000
  
  # Maximum coalesce iterations before detecting cyclic coalescing
  # Prevents infinite loops if mutation.coalesce(other) returns 'this' indefinitely
  # Default: 1000
  max-coalesce-iterations: 1000
  
  # Timeout for database load/save operations
  # Default: 30s
  # Formats: 5s, 500ms, 1m, etc.
  timeout: 5s
  
  # How long to retain idle workers in cache before eviction
  # Default: 10m
  worker-eviction-time: 5m
  
  # Maximum number of concurrent entity workers (0 = unbounded)
  # Default: 0 (unbounded)
  max-cached-workers: 100000
  
  # Timeout for graceful shutdown draining
  # Default: 10s
  shutdown-timeout: 30s
  
  # Polling interval during shutdown to check worker status
  # Default: 100ms
  shutdown-polling-interval: 50ms
  
  # Virtual thread name prefix for observability
  # Default: "laminar-worker-"
  thread-name-prefix: "my-app-worker-"

  # Dead Letter Queue (DLQ) Configuration
  dlq:
    enabled: true
    store: redis        # memory, redis
    max-retries: 3      # Max retries before moving to DLQ (if using retriable mechanism)
    ttl: 7d             # Retention period for DLQ entries

  # Clustering Configuration
  cluster:
    enabled: false
    shards: 16          # Number of Redis Stream shards (concurrent consumers)

  # Saga Configuration
  saga:
    enabled: true
    state-store: redis  # memory, redis
    retry:
      max-attempts: 3
      backoff: 1s
      jitter-percent: 0.5
    recovery:
      enabled: true
      interval: 30s
      distributed-locking: true
